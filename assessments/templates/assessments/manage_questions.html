{% extends 'base.html' %}
{% load static %}

{% block title %}MindCare | Manage Questions for {{ assessment.name }}{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="text-center mb-4">Manage Questions for "{{ assessment.name }}"</h2>
    <p class="lead text-center mb-5">Add, edit, or delete questions for this assessment.</p>

    <div class="text-center mb-4">
        <a href="{% url 'assessments:add_question' assessment.pk %}" class="btn btn-primary btn-lg">
            <i class="fas fa-plus-circle me-2"></i>Add New Question
        </a>
    </div>

    <div class="card shadow-sm mt-4">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0"><i class="fas fa-list-alt me-2"></i>Existing Questions</h5>
        </div>
        <div class="card-body">
            {% if questions %}
            <ul class="list-group">
                {% for question in questions %}
                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                    <div class="flex-grow-1 me-2 mb-2 mb-md-0">
                        <strong>{{ forloop.counter }}. {{ question.text }}</strong>
                        <div class="mt-2">
                            <small class="text-muted">Choices:</small>
                            <ul class="list-unstyled mb-0 ms-3">
                                {% for choice in question.choice_set.all %}
                                    <li>{{ choice.text }} (Score: {{ choice.score }})</li>
                                {% empty %}
                                    <li><small class="text-danger">No choices defined. Add choices via Django Admin.</small></li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="d-flex flex-row flex-md-column align-items-end">
                        <a href="{% url 'assessments:edit_question' question.pk %}" class="btn btn-sm btn-outline-primary me-2 mb-md-2">
                            <i class="fas fa-edit"></i> Edit Question
                        </a>
                        <form action="{% url 'assessments:delete_question' question.pk %}" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this question and its choices/answers?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i> Delete Question</button>
                        </form>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="alert alert-info text-center" role="alert">
                <i class="fas fa-info-circle me-2"></i>No questions added yet for this assessment.
            </div>
            {% endif %}
        </div>
    </div>

    <div class="text-center mt-5">
        <a href="{% url 'assessments:manage_assessments' %}" class="btn btn-secondary btn-lg">
            <i class="fas fa-arrow-left me-2"></i>Back to Assessments
        </a>
    </div>
</div>
{% endblock %}
